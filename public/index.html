<!DOCTYPE html>
<html>
<head>
  <title>Solar Quotation Form</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    input[readonly] { background-color: #f0f0f0; }
    h2 { margin-bottom: 20px; }
    button { margin-top: 20px; padding: 10px 20px; }
  </style>
</head>
<body>
  <h2>10 KW Solar PV Quotation</h2>
  <form id="quotationForm">
    <table>
      <tr>
        <th>Field</th>
        <th>Value</th>
      </tr>
      <tr>
        <td>System Cost (₹)</td>
        <td><input type="number" id="systemCost" required></td>
      </tr>
      <tr>
        <td>GST %</td>
        <td><input type="number" id="gstPercent" value="8.9" required></td>
      </tr>
      <tr>
        <td>GST Amount (₹)</td>
        <td><input type="number" id="gstAmount" readonly></td>
      </tr>
      <tr>
        <td>Total Project Cost (₹)</td>
        <td><input type="number" id="totalCost" readonly></td>
      </tr>
      <tr>
        <td>60% Advance</td>
        <td><input type="number" id="advance" readonly></td>
      </tr>
      <tr>
        <td>30% Proforma</td>
        <td><input type="number" id="proforma" readonly></td>
      </tr>
      <tr>
        <td>5% Commissioning</td>
        <td><input type="number" id="commissioning" readonly></td>
      </tr>
      <tr>
        <td>5% Meter Installation</td>
        <td><input type="number" id="meter" readonly></td>
      </tr>
    </table>
    <button type="submit">Generate Quotation PDF</button>
  </form>

  <p id="downloadLink"></p>

  <script>
    const form = document.getElementById('quotationForm');
    const systemCost = document.getElementById('systemCost');
    const gstPercent = document.getElementById('gstPercent');
    const gstAmount = document.getElementById('gstAmount');
    const totalCost = document.getElementById('totalCost');
    const advance = document.getElementById('advance');
    const proforma = document.getElementById('proforma');
    const commissioning = document.getElementById('commissioning');
    const meter = document.getElementById('meter');
    const downloadLink = document.getElementById('downloadLink');

    function calculate() {
      const cost = parseFloat(systemCost.value) || 0;
      const gst = (cost * (parseFloat(gstPercent.value) || 0)) / 100;
      const total = cost + gst;

      gstAmount.value = gst.toFixed(2);
      totalCost.value = total.toFixed(2);

      advance.value = (total * 0.60).toFixed(2);
      proforma.value = (total * 0.30).toFixed(2);
      commissioning.value = (total * 0.05).toFixed(2);
      meter.value = (total * 0.05).toFixed(2);
    }

    systemCost.addEventListener('input', calculate);
    gstPercent.addEventListener('input', calculate);

    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      const payload = {
        systemCost: systemCost.value,
        gstPercent: gstPercent.value,
        gstAmount: gstAmount.value,
        totalCost: totalCost.value,
        advance: advance.value,
        proforma: proforma.value,
        commissioning: commissioning.value,
        meter: meter.value
      };

      const res = await fetch('/generate-pdf', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      downloadLink.innerHTML = `<a href="${data.link}" target="_blank">Download Quotation PDF</a>`;
    });
  </script>
</body>
</html>
